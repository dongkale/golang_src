<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>라이브인터뷰</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" type="text/css"/>
    <link href="/static/css/style_nvn3.css?v=1" rel="stylesheet">	

    <!-- 기본JS -->
    <script src="https://kit.fontawesome.com/db6adb475d.js" crossorigin="anonymous"></script>
    <script src="/static/js/jquery-3.3.1.min.js"></script>
    <script src="/static/js/jquery-migrate-1.2.1.js"></script>
    <script src="/static/js/jquery-ui.min.js"></script>
    <script src="/static/plugin/jui-grid/jui-core.min.js"></script>
    <script src="/static/plugin/jui-grid/jui-ui.js"></script>
    <script src="/static/plugin/jui-grid/jui-grid.min.js"></script>
    <script src="/static/js/common.js?v=0.0.11"></script>
    <script src="/static/js/customInput.jquery.js"></script>

    <link rel="stylesheet" href="/static/css/live.css" type="text/css">

    <!-- validation -->
    <script type="text/javascript" src="/static/js/jquery.validate.js"></script>
    <script type="text/javascript" src="/static/js/additional-methods.js"></script>

    <!-- timepicker -->
    <script type="text/javascript" src="/static/js/jquery.datetimepicker.full.js"></script>
    <script type="text/javascript" src="/static/js/jquery.timepicker.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Ads: 661333810 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-661333810"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'AW-661333810');
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@remotemonster/sdk/remon.min.js"></script>
    <!-- <script src="/static/js/remon.min.js"></script> -->
    <script src="/static/js/remoteMonster.js"></script>

    <style>
      .panel-body {
          padding: 0px;
      }
      .panel {
        border: 0px solid transparent;
      }      
     
      .row {
          margin-right: -2px;
          margin-left: -2px;
      }

      .col-xs-1, .col-sm-1, .col-md-1, .col-lg-1, .col-xs-2, .col-sm-2, .col-md-2, .col-lg-2, .col-xs-3, .col-sm-3, .col-md-3, .col-lg-3, .col-xs-4, .col-sm-4, .col-md-4, .col-lg-4, .col-xs-5, .col-sm-5, .col-md-5, .col-lg-5, .col-xs-6, .col-sm-6, .col-md-6, .col-lg-6, .col-xs-7, .col-sm-7, .col-md-7, .col-lg-7, .col-xs-8, .col-sm-8, .col-md-8, .col-lg-8, .col-xs-9, .col-sm-9, .col-md-9, .col-lg-9, .col-xs-10, .col-sm-10, .col-md-10, .col-lg-10, .col-xs-11, .col-sm-11, .col-md-11, .col-lg-11, .col-xs-12, .col-sm-12, .col-md-12, .col-lg-12 {
          padding-right: 2px;
          padding-left: 2px;
      }

      .panel {
          margin-bottom: 4px;
      }

      .panel-heading {
          padding: 0px 15px;
      }

      .panel-title {
          font-size: 13px;
      } 
    </style>

  </head>

    <!-- Custom styles for this template-->
    <!-- <link href="css/sb-admin-2.min.css" rel="stylesheet" /> -->

  <!-- </head> -->

  <body>	
<!--
    <img style="position: absolute; top: 0; left: 0; border: 0; z-index: 1001;" src="/static/images/logo-admin-top-white.png" alt="직감 라이브 인터뷰">
    <nav class="navbar navbar-default navbar-static-top">
    </nav>
-->

    <div class="live-nvn-wrapper" style="height:50px;">
      <!--live-nvn-top-->
      <div class="live-nvn-top">
        <div class="live-nvn-top-logo">
          <img src="/static/images/logo-admin-top-white.png">

        </div>
        <!-- live-timer -->
        <!-- <div class="live-nvn-timer">
          <div class="live-nvn-timer-left">
            &middot; LIVE
          </div>
          <div class="live-nvn-timer-right">
            <a id="elapse_time" class="elapse_time" style="color:#FFF;width:50px;height:50px;font-size:17px;">00:00:00</a> 
          </div>
        </div> -->
        <!-- live-timer -->
        <div class="live-nvn-top-buttons">
          <div class="live-nvn-top-button hide" id="toggle-full-screen" onClick="toggleFullScreen();"  >
            <img src="/static/images/ic-topbar-live-full.svg"><a id="request_full_screen">전체 화면</a>
          </div>
          <div class="live-nvn-top-button hide" id="toggle-mute-video" onClick="toggleMuteVideo();"  >
            <img src="/static/images/ic_videocam_off.svg" id="local_video_mute_img"><a id="local_video_mute">화면 전송 끄기</a>
          </div>
          <!-- <div class="live-nvn-top-button" onClick="viewMode1();">
            <img src="/static/images/ic-topbar-live-mute-off.svg" id="local_audio_mute_img"><a id="local_mic_mute">수평모드</a>
          </div> -->
          <div class="live-nvn-top-button" onClick="toggleViewMode();">
            <img src="/static/images/horizontal_view_mode.svg" id="view_vertical_mode_img"><a id="view_vertical_mode">수평모드</a>
          </div>
          <div class="live-nvn-top-button" onClick="toggleMic();">
            <img src="/static/images/ic-topbar-live-mute-off.svg" id="local_audio_mute_img"><a id="local_mic_mute">마이크 끄기</a>
          </div>
          <div class="live-nvn-top-button" onClick="startItv();" >
            <img src="/static/images/ic-topbar-live-refresh.svg">새로고침
          </div>              
          <div class="live-nvn-top-button" onClick="exitWindowPop();" id="live-nvn-exit-button" style="display: none;">
            <img src="/static/images/ic-topbar-live-close-alone.svg">나가기
          </div>
          <div class="live-nvn-top-button" onClick="closeWindowPop();" id="live-nvn-close-button" style="display: none;">
            <img src="/static/images/ic-topbar-live-close-end.svg">종료하기
          </div>   
        </div>
      </div>         
    </div>   

   

      <!--live-nvn-top-->
    
    <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-6" id="main"><h4>지원자</h4>
          <div class="row">
            <div class="col-xs-12 col-md-6 " id="live-face-1-div">
              <div class="panel panel-default">

                <div class="panel-body relative" id="otherVideos1"></div>
              </div>
            </div>
            <div class="col-xs-12 col-md-6 " id="live-face-2-div">
              <div class="panel panel-default">

                <div class="panel-body relative" id="otherVideos2"></div>
              </div>
            </div>
            <div class="col-xs-12 col-md-6 " id="live-face-3-div">
              <div class="panel panel-default">

                <div class="panel-body relative" id="otherVideos3"></div>
              </div>
            </div>
            <div class="col-xs-12 col-md-6 " id="live-face-4-div">
              <div class="panel panel-default">

                <div class="panel-body relative" id="otherVideos4"></div>
              </div>
            </div>
            <div class="col-xs-12 col-md-6 " id="live-face-5-div">
              <div class="panel panel-default">

                <div class="panel-body relative" id="otherVideos5"></div>
              </div>
            </div>
            <div class="col-xs-12 col-md-6 "  id="live-face-6-div">
              <div class="panel panel-default">

                <div class="panel-body relative" id="otherVideos6"></div>
              </div>
            </div>
          </div>       
        </div>

        <div class="col-xs-6 col-md-2 hide" id="dummy">
          <br>
          <br>
          <br>
        </div>       
        <div class="col-xs-6 col-md-3" id="margin">
        </div>
        
        <div class="col-xs-6 col-md-2" id="master"><h4>면접관</h4>
          <div class="row">
            <div class="col-xs-12 col-md-12 hide" id="live-thum-1-div">
              <div class="panel panel-default" style="margin-bottom: 19px;">

                <div class="panel-body relative" id="live-thum-stream-1">
                  <div class="0" id="null">
                    <span class='label label-primary' id='live-thum-stream-1-tit1' style='z-index: 1; position: absolute; top: 0px; left: 0px;'></span>
                    <span class='label label-info' id='live-thum-stream-1-tit2' style='z-index: 1; position: absolute; top: 0px; right: 0px;'></span>

                    <div class="live-nvn-thum-mute hide" id="live-thum-mute-0" onClick="toggleRemoteMuteAudio($('#live-thum-1-div'))">
                      <img src="/static/images/ic-live-video-call-mute-off.svg" class="live-thum-mute-pic">
                    </div>
                    <span class='label label-primary hide' id='curres' style='z-index: 1; position: absolute; bottom: 0px; left: 0px;'></span>
                    <span class='label label-info hide' id='curbitrate' style='z-index: 1; position: absolute; bottom: 0px; right: 0px;'></span>
                  </div>
                </div>

           
              </div>
            </div>
            <div class="col-xs-12 col-md-12 hide" id="live-thum-2-div">
              <div class="panel panel-default" style="margin-bottom: 19px;">

                <div class="panel-body relative" id="live-thum-stream-2">
                  <div class="1" id="null">
                    <span class='label label-primary' id='live-thum-stream-2-tit1' style='z-index: 1; position: absolute; top: 0px; left: 0px;'></span>
                    <span class='label label-info' id='live-thum-stream-2-tit2' style='z-index: 1; position: absolute; top: 0px; right: 0px;'></span>

                    <div class="live-nvn-thum-mute hide" id="live-thum-mute-1" onClick="toggleRemoteMuteAudio($('#live-thum-2-div'))">
                      <img src="/static/images/ic-live-video-call-mute-off.svg" class="live-thum-mute-pic">
                    </div>
                    <span class='label label-primary hide' id='curres' style='z-index: 1; position: absolute; bottom: 0px; left: 0px;'></span>
                    <span class='label label-info hide' id='curbitrate' style='z-index: 1; position: absolute; bottom: 0px; right: 0px;'></span>
                  </div>
                </div>

              </div>
            </div>
            <div class="col-xs-12 col-md-12 hide" id="live-thum-3-div">
              <div class="panel panel-default" style="margin-bottom: 19px;">

                <div class="panel-body relative" id="live-thum-stream-3">
                  <div class="2" id="null">
                    <span class='label label-primary' id='live-thum-stream-3-tit1' style='z-index: 1; position: absolute; top: 0px; left: 0px;'></span>
                    <span class='label label-info' id='live-thum-stream-3-tit2' style='z-index: 1; position: absolute; top: 0px; right: 0px;'></span>

                    <div class="live-nvn-thum-mute hide" id="live-thum-mute-2" onClick="toggleRemoteMuteAudio($('#live-thum-3-div'))">
                      <img src="/static/images/ic-live-video-call-mute-off.svg" class="live-thum-mute-pic">
                    </div>
                    <span class='label label-primary hide' id='curres' style='z-index: 1; position: absolute; bottom: 0px; left: 0px;'></span>
                    <span class='label label-info hide' id='curbitrate' style='z-index: 1; position: absolute; bottom: 0px; right: 0px;'></span>
                  </div>
                </div>

              </div>
            </div>
            <div class="col-xs-12 col-md-12 hide" id="live-thum-4-div">
              <div class="panel panel-default" style="margin-bottom: 19px;">

                <div class="panel-body relative" id="live-thum-stream-4">
                  <div class="3" id="null">
                    <span class='label label-primary' id='live-thum-stream-4-tit1' style='z-index: 1; position: absolute; top: 0px; left: 0px;'></span>
                    <span class='label label-info' id='live-thum-stream-4-tit2' style='z-index: 1; position: absolute; top: 0px; right: 0px;'></span>

                    <div class="live-nvn-thum-mute hide" id="live-thum-mute-3" onClick="toggleRemoteMuteAudio($('#live-thum-4-div'))">
                      <img src="/static/images/ic-live-video-call-mute-off.svg" class="live-thum-mute-pic">
                    </div>
                    <span class='label label-primary hide' id='curres' style='z-index: 1; position: absolute; bottom: 0px; left: 0px;'></span>
                    <span class='label label-info hide' id='curbitrate' style='z-index: 1; position: absolute; bottom: 0px; right: 0px;'></span>
                  </div>
                </div>

              </div>
            </div>
          </div>                  
        </div>        
      </div>
    </div>

    <div class="container hide">
      <div class="row hide">
        <span class="col-md-3">
          <div class="small mb-1">영상선택</div>
          <select
            id="videoInputSelect"
            onchange="changeVideoInputDevice()"
            class="custom-select custom-select-sm form-control form-control-sm"
          ></select>
        </span>
        <!--Audio Input-->
        <span class="col-md-3">
          <div class="small mb-1">음성선택</div>
          <select
            id="audioInputSelect"
            onchange="changeAudioInputDevice()"
            class="custom-select custom-select-sm form-control form-control-sm"
          ></select>
        </span>

        <!--Video Codec-->
        <span class="col-md-2">
          <div class="small mb-1">비디오 코덱</div>
          <select
            id="videoCodecSelect"
            onchange="changeVideoCodec()"
            class="custom-select custom-select-sm form-control form-control-sm"
          >
            <option value="h264">H.264</option>
            <option value="vp8" selected>VP8</option>
            <option value="vp9">VP9</option>
          </select>
        </span>

        <!--Video FPS-->
        <span class="col-md-2">
          <div class="small mb-1">비디오 프레임</div>
          <input
            id="videoFPSInput"
            onchange="changeVideoFPS()"
            class="form-control-sm form-control text-center mb-4"
            type="text"
            value="25"
          />
        </span>

        <!--Video FPS-->
        <span class="col-md-2">
          <div class="small mb-1">화면 해상도</div>
          <select
            id="resolutionSelect"
            onchange="changeResolution()"
            class="custom-select custom-select-sm form-control form-control-sm"
          >
            <option value="640">480x640</option>
            <option value="480">640x480</option>
          </select>
        </span>      
      </div>
    </div>  


    
    <!-- 나가기 팝업 -->
    <div class="popupWrap" id="live_exit_pop">
      <div class="popLayer">
        <div class="popCont">
          <p class="tit">정말 나가시겠습니까?</p>			
        </div>
        <div class="btnSet">
          <a href="javascript:void(0);" class="btn" onclick="closePopup()" style="font-size:14px;">취소</a>
          <a href="javascript:void(0);" class="btn type_red" id="btn_live_exit" style="font-size:14px;">나가기</a>
        </div>
      </div>
      <span class="cover"></span>
    </div>
    <!-- 나가기 팝업 -->
    
    <!-- 종료 팝업 -->
    <div class="popupWrap" id="live_close_pop">
      <div class="popLayer">
        <div class="popCont">
          <p class="tit">인터뷰가 완전히 끝난 경우에만 
            선택해주세요.</p>
          <p class="sub">종료하시면 모든 참여자가 해당
            라이브 인터뷰에 입장하실 수
            없게 됩니다. 정말
            종료하시겠어요?</p>

        </div>
        <div class="btnSet">
          <a href="javascript:void(0);" class="btn" onclick="closePopup()" style="font-size:14px;">취소</a>
          <a href="javascript:void(0);" class="btn type_red st02" id="btn_live_close" style="font-size:14px;">종료</a>
        </div>
      </div>
      <span class="cover"></span>
    </div>
    <!-- 종료 팝업 -->


    <!-- 오디오 선택 -->
    <div class="popupWrap" id="live_audio_video" >
      <div class="popLayer" style="width: 565px;">
        <div class="popCont">
          <p>오디오를 선택하세요</p>	
          <label for="audioSource"></label><select id="audioSource" onchange="changeAudioInputDevice()"></select>		
          <p>비디오를 선택하세요</p>	
          <label for="videoSource"></label><select id="videoSource" onchange="changeVideoInputDevice()"></select>	
        </div>
        <div class="btnSet">
          <a href="javascript:void(0);" class="btn" id="btn_live_audio_video_cancel" style="font-size:14px;">취소</a>
          <a href="javascript:void(0);" class="btn type_blue st02" id="btn_live_audio_video_ok" style="font-size:14px;">다음</a>
        </div>
      </div>
      <span class="cover"></span>
    </div>
    <!-- 오디오 선택 -->
    <!-- 오디오, 비디오 선택 -->
    <script src="https://www.webrtc-experiment.com/getStats.js"></script>
    <script>
      var videoElement = null;
      

      const videoInputSelect = document.getElementById("videoInputSelect");
      const audioInputSelect = document.getElementById("audioInputSelect");
      const videoCodecSelect = document.getElementById("videoCodecSelect");
      const videoFPSInput = document.getElementById("videoFPSInput");

      var audioSelect = document.querySelector('select#audioSource');
      var videoSelect = document.querySelector('select#videoSource');

      // var videoElement = document.querySelector('video');
      // var audioSelect = document.querySelector('select#audioSource');
      // var videoSelect = document.querySelector('select#videoSource');

      // audioSelect.onchange = getStream;
      // videoSelect.onchange = getStream;
      
      // getStream().then(getDevices).then(gotDevices);
      
      function getDevices() {
          // AFAICT in Safari this only gets default devices until gUM is called :/
          return navigator.mediaDevices.enumerateDevices();
      }
      
      function gotDevices(deviceInfos) {
          window.deviceInfos = deviceInfos; // make available to console
          console.log('Available input and output devices:', deviceInfos);
        
          for (const deviceInfo of deviceInfos) {
          const option = document.createElement('option');
          option.value = deviceInfo.deviceId;
          if (deviceInfo.kind === 'audioinput') {
              option.text = deviceInfo.label || `Microphone ${audioSelect.length + 1}`;
              audioSelect.appendChild(option);
          } else if (deviceInfo.kind === 'videoinput') {
              option.text = deviceInfo.label || `Camera ${videoSelect.length + 1}`;
              videoSelect.appendChild(option);
          }
          }


          cameraList = [];
          micList = [];
          for (let i = 0; i < deviceInfos.length; i++) {
                let device = deviceInfos[i];

                if (device.kind === "videoinput") {
                  cameraList.push({ text: device.label, id: device.deviceId });
                } else if (device.kind === "audioinput") {
                  micList.push({ text: device.label, id: device.deviceId });
                }
                // else if (device.kind === 'audiooutput') {
                //     speakerList.push({ text: device.label, id: device.deviceId })
                // }
              }

              const video_selects = document.querySelectorAll('#videoInputSelect > option');
              video_selects.forEach( x => {
                x.remove();
              });

              const aud_selects = document.querySelectorAll('#audioInputSelect > option');
              aud_selects.forEach( x => {
                x.remove();
              });

              for (let i = 0; i < cameraList.length; i++) {
                const videoInputOption = document.createElement("option");
                videoInputOption.value = cameraList[i].id;
                videoInputOption.text = cameraList[i].text;
                videoInputSelect.appendChild(videoInputOption);
              }

              for (let i = 0; i < micList.length; i++) {
                const audioInputOption = document.createElement("option");
                audioInputOption.value = micList[i].id;
                audioInputOption.text = micList[i].text;
                audioInputSelect.appendChild(audioInputOption);
              }
      }

      function getStream() {
          if (window.stream) {
          window.stream.getTracks().forEach(track => {track.stop();});
        }

        const audioSource = audioSelect.value;
        const videoSource = videoSelect.value;

        const constraints = {
          audio: {deviceId: audioSource ? {exact: audioSource} : undefined},
          video: {deviceId: videoSource ? {exact: videoSource} :  undefined}
        };

        console.log("========================" + JSON.stringify(constraints));
        console.log("========================" + videoSource);

            return navigator.mediaDevices.getUserMedia(constraints).then(gotStream).catch(handleError);

      }

      function gotStream(stream) {
        console.log("========================" + stream);
        window.stream = stream; // make stream available to console
      
        console.log("========================11" + stream);
          audioSelect.selectedIndex = [...audioSelect.options].
          findIndex(option => option.text === stream.getAudioTracks()[0].label);

          videoSelect.selectedIndex = [...videoSelect.options].
          findIndex(option => option.text === stream.getVideoTracks()[0].label);

          videoElement.srcObject = stream;
      }

      function handleError(error) {
        console.log('Error: ', error);
      }		  
      
    
    
    
    

            var entp_mem_no = {{.EntpMemNo}};
            var entp_mem_sn = {{.SMemSn}};
            var entp_admin = {{.EntpAdmin}};
            var pp_mem_no = {{.PpMemNo}};		
            var pp_mem_nm = {{.PpMemNm}};		
            var pto_path = {{.PtoPath}};
            var recrut_sn = {{.RecrutSn}};
            var live_sn = {{.pLiveSn}};
            var entp_gbn = {{.EntpGbn}};
            var member_list = {{.LiveMemList}};	
            var member_list_cnt =  member_list === null?0:member_list.length;
            var member_apply_cnt = 0;
            // var remon_list_cnt =  member_list_cnt + 1;	// 구직자 + 맴버 인원수

            // var pto_path = {{.PtoPath}};
            
            // // var videoElement = document.querySelector('video');
            // var audioSelect = document.querySelector('select#audioSource');
            // var videoSelect = document.querySelector('select#videoSource');
            
            
            let cameraList = [];
            let micList = [];
            var session_key_list = [];
            var entp_mem_pos = [];
            var mem_no_connect_list = [];
            let remon;
            let remote_remon = [];

            let fullScreenEnabled = false;
            let viewModeEnabled = false;
            let localAudioEnabled = true;
            let localVideoEnabled = true;
            let display_stat_flag = false;

            //const enterBtn = document.querySelector("#enterBtn");
            const checkBtn = document.querySelector("#checkBtn");
            const otherVideos= document.getElementById('otherVideos');
            let liveThumStream=[];
            liveThumStream[0] = document.querySelector('#live-thum-stream-1');
            liveThumStream[1] = document.querySelector('#live-thum-stream-2');
            liveThumStream[2] = document.querySelector('#live-thum-stream-3');
            liveThumStream[3] = document.querySelector('#live-thum-stream-4');

            let otherVideo=[];
            otherVideo[0] = document.querySelector('#otherVideos1');
            otherVideo[1] = document.querySelector('#otherVideos2');
            otherVideo[2] = document.querySelector('#otherVideos3');
            otherVideo[3] = document.querySelector('#otherVideos4');
            otherVideo[4] = document.querySelector('#otherVideos5');
            otherVideo[5] = document.querySelector('#otherVideos6');

            // if (entp_admin == '01') {
            //   var close_button = document.querySelector('#live-nvn-close-button');
            //   var exit_button = document.querySelector('#live-nvn-exit-button');
            //   close_button.removeAttribute("style");
            //   exit_button.removeAttribute("style");
            // }
            // else 
            if (entp_gbn == 'E') {
              var close_button = document.querySelector('#live-nvn-close-button');
              var exit_button = document.querySelector('#live-nvn-exit-button');
              close_button.removeAttribute("style");
              exit_button.removeAttribute("style");
            }


            const selectedRoom = document.getElementById(
              "selectedRoom"
            );
            let isConnected = false;
            
            let roomName = entp_mem_no+"_"+recrut_sn+"_"+live_sn;
            let currentRoom=[];
            const rooms = [];
            // https://obfuscator.io/ 에서 난독화 하였다.
            // 옵션은 
            // String Array Wrappers Type : Function 변경
            // String Array Encoding : Base64 변경
            // const key = "859ee8d60826e81cef04403c88a6c5cf91dd2929fe9f4ff4180bcdbe9ca4f815";
            // const serviceId = "51612ee3-a43c-41d0-9801-4a7e06a8eaf3";
            const _0x4a31=['nte2mtjLztmTytqZyY00mwqWltK4mdeTnge3zta2ytHLywyZ','odu5zwu4zdyWodi2ztGXy2vMmdq0mdnJodHHnMm1y2y5mwrKmJKYowzLowy0zMy0mtGWyMnKyMu5y2e0zJGXnq','mJC0nJeZq2jkBKnT','n2zpwwPxvq','mJq3mtrKAK1kzem','mJu2ndy1nNHhCe9Kza','nti3nNzcA0nwqG','mtGXndq1n3n0ExPdsa','odi2mJuZs01Ksu1b','mJe0ANr6z0XU','mtrjA0LlDhq','odqZntqYrwfqufvl'];const _0x44c9=function(_0x1829b7,_0xd726eb){_0x1829b7=_0x1829b7-0x16a;let _0x4a3122=_0x4a31[_0x1829b7];if(_0x44c9['OtXXfU']===undefined){var _0x44c9da=function(_0x1ad68f){const _0x2c8e6='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x441c8a='';for(let _0x5c899a=0x0,_0x4e5dc0,_0x4f6de5,_0x4968ec=0x0;_0x4f6de5=_0x1ad68f['charAt'](_0x4968ec++);~_0x4f6de5&&(_0x4e5dc0=_0x5c899a%0x4?_0x4e5dc0*0x40+_0x4f6de5:_0x4f6de5,_0x5c899a++%0x4)?_0x441c8a+=String['fromCharCode'](0xff&_0x4e5dc0>>(-0x2*_0x5c899a&0x6)):0x0){_0x4f6de5=_0x2c8e6['indexOf'](_0x4f6de5);}return _0x441c8a;};_0x44c9['xcAwIO']=function(_0x3ab1fa){const _0xa02706=_0x44c9da(_0x3ab1fa);let _0x397c8c=[];for(let _0x37b877=0x0,_0x1bd0e9=_0xa02706['length'];_0x37b877<_0x1bd0e9;_0x37b877++){_0x397c8c+='%'+('00'+_0xa02706['charCodeAt'](_0x37b877)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x397c8c);},_0x44c9['TFCsxa']={},_0x44c9['OtXXfU']=!![];}const _0x5b9a6b=_0x4a31[0x0],_0x13c7dd=_0x1829b7+_0x5b9a6b,_0x2722e4=_0x44c9['TFCsxa'][_0x13c7dd];return _0x2722e4===undefined?(_0x4a3122=_0x44c9['xcAwIO'](_0x4a3122),_0x44c9['TFCsxa'][_0x13c7dd]=_0x4a3122):_0x4a3122=_0x2722e4,_0x4a3122;};const _0x790d8=function(_0x5bea2d,_0x3bc3a4){return _0x44c9(_0x3bc3a4-0x219,_0x5bea2d);};(function(_0x41f1db,_0x12ef08){const _0x38f5f5=function(_0x2611bc,_0x43900a){return _0x44c9(_0x43900a- -0x29e,_0x2611bc);};while(!![]){try{const _0x5a6c21=parseInt(_0x38f5f5(-0x12f,-0x130))*-parseInt(_0x38f5f5(-0x129,-0x12d))+parseInt(_0x38f5f5(-0x12b,-0x12c))*-parseInt(_0x38f5f5(-0x135,-0x132))+-parseInt(_0x38f5f5(-0x126,-0x12b))+parseInt(_0x38f5f5(-0x137,-0x133))*-parseInt(_0x38f5f5(-0x134,-0x134))+parseInt(_0x38f5f5(-0x130,-0x12e))+parseInt(_0x38f5f5(-0x133,-0x12f))+parseInt(_0x38f5f5(-0x132,-0x131));if(_0x5a6c21===_0x12ef08)break;else _0x41f1db['push'](_0x41f1db['shift']());}catch(_0x5910e6){_0x41f1db['push'](_0x41f1db['shift']());}}}(_0x4a31,0xeb779));const key=_0x790d8(0x38d,0x38e),serviceId=_0x790d8(0x387,0x38d);
            // 새로 고침이나 종료시에 리모트 몬스터 객체를 close 한다.
            window.onbeforeunload = function(e){
                // 프로그램 종료 or F5키 눌렀을때
                remon.close()

                var returnValue = {
                    stat : "Force_Exit",
                    recrut_sn: recrut_sn,
                    pp_mem_no: pp_mem_no,
                    live_sn: live_sn
                };
                        
                if (window.opener) {
                    if (window.opener.getLiveItvResult) {
                    window.opener.getLiveItvResult(JSON.stringify(returnValue)); 		
                    } else {    
                        sessionStorage.removeItem(`LiveItv_${live_sn}`);    
                    }
                } else {     
                    sessionStorage.removeItem(`LiveItv_${live_sn}`);    
                }    
            }
  
            document.onkeydown = function(e){
                /* F5, Ctrl+r, Ctrl+F5 */
                if(e.keyCode == 116 || e.ctrlKey == true && (e.keyCode == 82)){
                    e.cancelBubble = true; 
                    e.returnValue = false; 
                    setTimeout(function(){
                        window.location.reload();
                    }, 1000);
                    return false;
                }
                else if (e.ctrlKey == true && e.altKey == true && e.keyCode == 68) { // ctrl+alt+d
                  display_stat_flag = !display_stat_flag;
                  const stat_curres = document.querySelectorAll('#curres');
                  stat_curres.forEach( curres => {
                    if(display_stat_flag) {
                      curres.classList.remove('hide');
                    }                      
                    else curres.classList.add('hide');
                  });

                  const stat_curbitrate = document.querySelectorAll('#curbitrate');
                  stat_curbitrate.forEach( curbitrate => {
                    if(display_stat_flag) {
                      curbitrate.classList.remove('hide');
                    }                      
                    else curbitrate.classList.add('hide');
                  });

                  const muteVideo = document.querySelector('#toggle-mute-video');
                  const fullVideo = document.querySelector('#toggle-full-screen');
                  if(display_stat_flag) {
                    muteVideo.classList.remove('hide');
                    fullVideo.classList.remove('hide');
                  }                      
                  else {
                    muteVideo.classList.add('hide');
                    fullVideo.classList.add('hide');
                  }

                }


                //console.log( "ctrlKey:"+e.ctrlKey +" altKey:" + e.altKey + " key:"+e.key + " keyCode:"+e.keyCode);
            }

            function viewMode1() {
                let livefacediv=[];
                livefacediv[0] = document.querySelector('#live-face-1-div');
                livefacediv[1] = document.querySelector('#live-face-2-div');
                livefacediv[2] = document.querySelector('#live-face-3-div');
                livefacediv[3] = document.querySelector('#live-face-4-div');
                livefacediv[4] = document.querySelector('#live-face-5-div');
                livefacediv[5] = document.querySelector('#live-face-6-div');

                main = document.querySelector('#main');
                dummy = document.querySelector('#dummy');
                margin = document.querySelector('#margin');
                master = document.querySelector('#master');

                let livethumdiv=[];
                livethumdiv[0] = document.querySelector('#live-thum-1-div');
                livethumdiv[1] = document.querySelector('#live-thum-2-div');
                livethumdiv[2] = document.querySelector('#live-thum-3-div');
                livethumdiv[3] = document.querySelector('#live-thum-4-div');

                var master_cnt = member_list_cnt - member_apply_cnt;
                if (member_apply_cnt == 1) {
                  $(livefacediv[0]).attr('class','col-xs-12 col-md-4  col-md-offset-4');
                } else if(member_apply_cnt == 2) {
                  $(livefacediv[0]).attr('class','col-xs-12 col-md-4  col-md-offset-2');
                  $(livefacediv[1]).attr('class','col-xs-12 col-md-4');
                } else if(member_apply_cnt == 3) {
                  $(mainbar).attr('class','col-xs-6 col-md-12');
                  $(mainbardummy).remove();
                  $(main).attr('class','col-xs-6 col-md-9');
                  $(dummy).remove();
                  $(livefacediv[0]).attr('class','col-xs-12 col-md-4');
                  $(livefacediv[1]).attr('class','col-xs-12 col-md-4');
                  $(livefacediv[2]).attr('class','col-xs-12 col-md-4');
                } else if(member_apply_cnt == 4) {
                  $(livefacediv[0]).attr('class','col-xs-12 col-md-3');
                  $(livefacediv[1]).attr('class','col-xs-12 col-md-3');
                  $(livefacediv[2]).attr('class','col-xs-12 col-md-3');
                  $(livefacediv[3]).attr('class','col-xs-12 col-md-3');
                } else if(member_apply_cnt == 5) {
                  $(mainbar).attr('class','col-xs-6 col-md-12');
                  $(mainbardummy).remove();
                  $(main).attr('class','col-xs-6 col-md-9');
                  $(dummy).remove();
                  $(livefacediv[0]).attr('class','col-xs-12 col-md-2  col-md-offset-1');
                  $(livefacediv[1]).attr('class','col-xs-12 col-md-2');
                  $(livefacediv[2]).attr('class','col-xs-12 col-md-2');
                  $(livefacediv[3]).attr('class','col-xs-12 col-md-2');
                  $(livefacediv[4]).attr('class','col-xs-12 col-md-2');
                } else if(member_apply_cnt == 6) {
                  $(mainbar).attr('class','col-xs-6 col-md-12');
                  $(mainbardummy).remove();
                  $(main).attr('class','col-xs-6 col-md-9');
                  $(dummy).remove();
                  $(livefacediv[0]).attr('class','col-xs-12 col-md-2');
                  $(livefacediv[1]).attr('class','col-xs-12 col-md-2');
                  $(livefacediv[2]).attr('class','col-xs-12 col-md-2');
                  $(livefacediv[3]).attr('class','col-xs-12 col-md-2');
                  $(livefacediv[4]).attr('class','col-xs-12 col-md-2');
                  $(livefacediv[5]).attr('class','col-xs-12 col-md-2');
                }            

                for(var i = 0;i<member_apply_cnt;i++)
                {
                  $(`#live-face-${i+1}-div`).removeClass("hide");
                }

                $(main).attr('class','row');
                $(dummy).attr('class','row');
                $(margin).attr('class','row');
                $(master).attr('class','row');

                if(master_cnt == 1) {
                    $(livethumdiv[0]).attr('class','col-xs-12 col-md-2  col-md-offset-5');
                } else if(master_cnt == 2) {
                    $(livethumdiv[0]).attr('class','col-xs-12 col-md-2  col-md-offset-4');
                    $(livethumdiv[1]).attr('class','col-xs-12 col-md-2');
                } else if(master_cnt == 3) {
                    $(livethumdiv[0]).attr('class','col-xs-12 col-md-2  col-md-offset-3');
                    $(livethumdiv[1]).attr('class','col-xs-12 col-md-2');
                    $(livethumdiv[2]).attr('class','col-xs-12 col-md-2');
                } else if(master_cnt == 4) {
                    $(livethumdiv[0]).attr('class','col-xs-12 col-md-2');
                    $(livethumdiv[1]).attr('class','col-xs-12 col-md-2');
                    $(livethumdiv[2]).attr('class','col-xs-12 col-md-2');
                    $(livethumdiv[3]).attr('class','col-xs-12 col-md-2');                  
                }
            }

            function viewMode2() {
              let livefacediv=[];
                livefacediv[0] = document.querySelector('#live-face-1-div');
                livefacediv[1] = document.querySelector('#live-face-2-div');
                livefacediv[2] = document.querySelector('#live-face-3-div');
                livefacediv[3] = document.querySelector('#live-face-4-div');
                livefacediv[4] = document.querySelector('#live-face-5-div');
                livefacediv[5] = document.querySelector('#live-face-6-div');

                main = document.querySelector('#main');
                dummy = document.querySelector('#dummy');
                margin = document.querySelector('#margin');
                master = document.querySelector('#master');

                let livethumdiv=[];
                livethumdiv[0] = document.querySelector('#live-thum-1-div');
                livethumdiv[1] = document.querySelector('#live-thum-2-div');
                livethumdiv[2] = document.querySelector('#live-thum-3-div');
                livethumdiv[3] = document.querySelector('#live-thum-4-div');

                if (member_apply_cnt == 1) {
                  $(livefacediv[0]).attr('class','col-xs-12 col-md-8');
                } else if(member_apply_cnt == 2) {
                  $(livefacediv[0]).attr('class','col-xs-12 col-md-6');
                  $(livefacediv[1]).attr('class','col-xs-12 col-md-6');
                } else if(member_apply_cnt == 3) {

                  $(livefacediv[0]).attr('class','col-xs-12 col-md-4');
                  $(livefacediv[1]).attr('class','col-xs-12 col-md-4');
                  $(livefacediv[2]).attr('class','col-xs-12 col-md-4');
                } else if(member_apply_cnt == 4) {
                  $(livefacediv[0]).attr('class','col-xs-12 col-md-6');
                  $(livefacediv[1]).attr('class','col-xs-12 col-md-6');
                  $(livefacediv[2]).attr('class','col-xs-12 col-md-6');
                  $(livefacediv[3]).attr('class','col-xs-12 col-md-6');
                } else if(member_apply_cnt == 5) {
                  $(mainbar).attr('class','col-xs-6 col-md-12');
                  $(mainbardummy).remove();
                  $(main).attr('class','col-xs-6 col-md-9');
                  $(dummy).remove();
                  $(livefacediv[0]).attr('class','col-xs-12 col-md-4');
                  $(livefacediv[1]).attr('class','col-xs-12 col-md-4');
                  $(livefacediv[2]).attr('class','col-xs-12 col-md-4');
                  $(livefacediv[3]).attr('class','col-xs-12 col-md-6');
                  $(livefacediv[4]).attr('class','col-xs-12 col-md-6');
                } else if(member_apply_cnt == 6) {
                  $(mainbar).attr('class','col-xs-6 col-md-12');
                  $(mainbardummy).remove();
                  $(main).attr('class','col-xs-6 col-md-9');
                  $(dummy).remove();
                  $(livefacediv[0]).attr('class','col-xs-12 col-md-4');
                  $(livefacediv[1]).attr('class','col-xs-12 col-md-4');
                  $(livefacediv[2]).attr('class','col-xs-12 col-md-4');
                  $(livefacediv[3]).attr('class','col-xs-12 col-md-4');
                  $(livefacediv[4]).attr('class','col-xs-12 col-md-4');
                  $(livefacediv[5]).attr('class','col-xs-12 col-md-4');
                }        

                for(var i = 0;i<member_apply_cnt;i++)
                {
                  $(`#live-face-${i+1}-div`).removeClass("hide");
                }

                $(main).attr('class','col-xs-6 col-md-6');
                $(dummy).attr('class','col-xs-6 col-md-2 hide');
                $(margin).attr('class','col-xs-6 col-md-4');
                $(master).attr('class','col-xs-6 col-md-2');

                $(livethumdiv[0]).attr('class','col-xs-12 col-md-12');
                $(livethumdiv[1]).attr('class','col-xs-12 col-md-12');
                $(livethumdiv[2]).attr('class','col-xs-12 col-md-12');
                $(livethumdiv[3]).attr('class','col-xs-12 col-md-12');              
            }
            

            function toggleViewMode() {
              if(viewModeEnabled == true) {
                viewModeEnabled = false;
                var view_vertical_txt= document.querySelector("#view_vertical_mode");
                view_vertical_txt.innerHTML = "수평모드"
                var view_vertical_img = document.querySelector("#view_vertical_mode_img");
                view_vertical_img.src = '/static/images/horizontal_view_mode.svg'
                viewMode2();
              }
                
              else   {
                viewModeEnabled = true;
                var view_vertical_txt= document.querySelector("#view_vertical_mode");
                view_vertical_txt.innerHTML = "수직모드"
                var view_vertical_img = document.querySelector("#view_vertical_mode_img");
                view_vertical_img.src = '/static/images/vertical_view_mode.svg'
                viewMode1();
              }

              
            }

            function toggleMic() {
              if(localAudioEnabled == true) {
                localAudioEnabled = false;
                var mic_txt= document.querySelector("#local_mic_mute");
                mic_txt.innerHTML = "마이크 켜기"
                var mic_img = document.querySelector("#local_audio_mute_img");
                
                mic_img.src = '/static/images/ic-topbar-live-mute-on.svg'
                
              }
                
              else   {
                localAudioEnabled = true;
                var mic_txt= document.querySelector("#local_mic_mute");
                mic_txt.innerHTML = "마이크 끄기"
                var mic_img = document.querySelector("#local_audio_mute_img");
                mic_img.src = '/static/images/ic-topbar-live-mute-off.svg'
               
              }
              

              remon.muteLocalAudio(!localAudioEnabled);
            }

            function toggleFullScreen() {
              if(fullScreenEnabled == true) {
                fullScreenEnabled = false;
                var video_txt= document.querySelector("#request_full_screen");
                video_txt.innerHTML = "전체 화면"
                document.exitFullscreen();
              }
                
              else   {
                fullScreenEnabled = true;
                var video_txt= document.querySelector("#request_full_screen");
                video_txt.innerHTML = "기본 화면"
                document.body.requestFullscreen();
                
              }
            }

            function toggleMuteVideo() {
              if(localVideoEnabled == true) {
                localVideoEnabled = false;
                var video_txt= document.querySelector("#local_video_mute");
                video_txt.innerHTML = "화면 전송 켜기"
                var video_img = document.querySelector("#local_video_mute_img");
                video_img.src = '/static/images/ic_videocam_on.svg'
                
              }
                
              else   {
                localVideoEnabled = true;
                var video_txt= document.querySelector("#local_video_mute");
                video_txt.innerHTML = "화면 전송 끄기"
                var video_img = document.querySelector("#local_video_mute_img");
                video_img.src = '/static/images/ic_videocam_off.svg'
              }
              
              
              remon.pauseLocalVideo(!localVideoEnabled);
            }

            function toggleRemoteMuteAudio(video_tag) {
              var remoteVideoMute = video_tag.find('video');
              if(remoteVideoMute[0].muted == true)
              {
                remoteVideoMute[0].muted = false;
              }
              else remoteVideoMute[0].muted = true;
            }

            function exitWindowPop() {

              $('html').scrollTop(0);
              openPopup("live_exit_pop");		
            }

            function closeWindowPop() {
              $('html').scrollTop(0);
              openPopup("live_close_pop");
            }

            function gracefulclose() {
              var returnValue = {
                stat : "Force_Exit",
                recrut_sn: recrut_sn,
                pp_mem_no: pp_mem_no,
                live_sn: live_sn
              };
                      
              if (window.opener) {
              	  if (window.opener.getLiveItvResult) {
                	  window.opener.getLiveItvResult(JSON.stringify(returnValue)); 
                  } else {    
                      sessionStorage.removeItem(`LiveItv_${live_sn}`);
                  }

                  window.open(location, '_self').close();	
              } else {    
                  sessionStorage.removeItem(`LiveItv_${live_sn}`);              
                  window.close();
              }
            }


            var ajax_remom_save_key = function(token, memNo, gbnCd) {

              // var formData = new FormData();
              //   formData.append("room_id", roomName);
              //   formData.append("channel_id", token);
              //   formData.append("my_mem_no", "E2019011900001");
              //   formData.append("gbn_cd", "002");
                
              $.ajax({
                cache: false,
                  url: "/live/conference/register/channelId",
                  data: {
                    "room_id": roomName,
                    "channel_id": token,
                    "my_mem_no":memNo,
                    "gbn_cd": gbnCd
                  },
                  type: "POST",
                  dataType: "json",
                  error : function(e) {
                    console.log("error" + e);
                  },
                  success : function(rep) {
                   
                 }
              });		
              
              console.log(`================================= ajax_remom_save_key`);
            }  

            var ajax_remom_get_key = function(channelId,retry,joinType) {
              $.ajax({
                  cache: false,
                  url: "/live/conference/get/channelId",
                  data: {
                    "room_id": roomName,
                    "channel_id": channelId,
                  },
                  type: "POST",
                  dataType: "json",
                  error : function(e) {
                    console.log("error : " + JSON.stringify(e));
                    // alert("error : " + JSON.stringify(e));
                    if(retry <= 1) {  // 2번까지 찾는다.
                      setTimeout( () => {
                        ajax_remom_get_key(channelId,retry + 1,joinType)
                        console.log("[" +channelId + "] ajax_remom_get_key retry count:" + retry + "joinType: " + joinType);
                      }, 1000); 
                    }
                      
                  },
                  success : function(rep) {
                    console.log(`================================= rep:`,rep);

                    session_key_list[roomName + "-" + rep.ChnnelId] = rep.EntpGbn 
                    let newVideo = document.createElement('video') 
                    thumPos = 0;
                    if(entp_mem_pos[rep.PpChrgSn] != null)
                    {
                      thumPos = entp_mem_pos[rep.PpChrgSn];
                    }

                    // 동시 접속 체크 
                    if(rep.EntpGbn == "1")
                    { // 기업
                      if(joinType == 'join')
                      { // 방에 있는 상태.
                          if(entp_mem_sn == rep.PpChrgSn) {
                            // 자기 자신이 또 들어온 경우 
                            disConnectRemoteMonster();
                            alert("다른 브라우저에서 접속 하였습니다.");
                            
                            if (window.opener) {
                              window.open('', '_self', '');
                              window.close();
                            }
                            else {
                              //window.close();
                            }
                            
                            return ;
                          }

                          if(mem_no_connect_list[rep.PpChrgSn] != null) {  // 이미 있는 경우다.
                            let video = document.getElementById(mem_no_connect_list[rep.PpChrgSn]);

                              for(var i=0;i < otherVideo.length; i++) {
                                if (otherVideo[i] != null && otherVideo[i].contains(video) == true)
                                  otherVideo[i].removeChild(video);
                              }

                              for(var i=0;i < liveThumStream.length; i++) {
                                if (liveThumStream[i] != null && liveThumStream[i].contains(video) == true)
                                  liveThumStream[i].removeChild(video);
                              }
                          }

                          mem_no_connect_list[rep.PpChrgSn] = roomName + "-" + rep.ChnnelId;
                      }
                      else {  // 방에 들어가면서 이미 있는 유저들을 얻어오는 경우.
                          if(entp_mem_sn == rep.PpChrgSn) {
                            // 자기 자신이 있다면 무시한다.
                            return ;
                          }
                          else {
                            if(mem_no_connect_list[rep.PpChrgSn] != null) {  // 이미 있는 경우다.
                              let video = document.getElementById(mem_no_connect_list[rep.PpChrgSn]);

                              for(var i=0;i < otherVideo.length; i++) {
                                  if (otherVideo[i] != null && otherVideo[i].contains(video) == true)
                                    otherVideo[i].removeChild(video);
                                }

                                for(var i=0;i < liveThumStream.length; i++) {
                                  if (liveThumStream[i] != null && liveThumStream[i].contains(video) == true)
                                    liveThumStream[i].removeChild(video);
                                }
                            }
                          }

                          mem_no_connect_list[rep.PpChrgSn] = roomName + "-" + rep.ChnnelId;
                      }
                    }
                    else {
                      // 개인 회원 처리.
                      if(joinType == 'join')
                      { // 방에 있는 상태.
                        if(rep.PpMemNo == pp_mem_no)
                        { // 내 자신이 또 들어 온다면 이중 접속 나 자신은 나가야 된다.
                            // 자기 자신이 또 들어온 경우 
                            disConnectRemoteMonster();
                            alert("다른 브라우저에서 접속 하였습니다.");
                            
                            if (window.opener) {
                              window.open('', '_self', '');
                              window.close();
                            }
                            else {
                              //window.close();
                            }
                            
                            return ;
                        }

                        if(mem_no_connect_list[rep.PpMemNo] != null) {  // 이미 있는 경우다.
                          let video = document.getElementById(mem_no_connect_list[rep.PpMemNo]);

                          for(var i=0;i < otherVideo.length; i++) {
                              if (otherVideo[i] != null && otherVideo[i].contains(video) == true)
                                otherVideo[i].removeChild(video);
                            }

                            for(var i=0;i < liveThumStream.length; i++) {
                              if (liveThumStream[i] != null && liveThumStream[i].contains(video) == true)
                                liveThumStream[i].removeChild(video);
                            }
                        }

                        mem_no_connect_list[rep.PpMemNo] = roomName + "-" + rep.ChnnelId;
                      }
                      else {
                        if(rep.PpMemNo == pp_mem_no) {
                          // 자기 자신이 있다면 무시한다.
                          return ;
                        }
                        else {
                          if(mem_no_connect_list[rep.PpMemNo] != null) {  // 이미 있는 경우다.
                            let video = document.getElementById(mem_no_connect_list[rep.PpMemNo]);

                            for(var i=0;i < otherVideo.length; i++) {
                                if (otherVideo[i] != null && otherVideo[i].contains(video) == true)
                                  otherVideo[i].removeChild(video);
                              }

                              for(var i=0;i < liveThumStream.length; i++) {
                                if (liveThumStream[i] != null && liveThumStream[i].contains(video) == true)
                                  liveThumStream[i].removeChild(video);
                              }
                          }

                          mem_no_connect_list[rep.PpMemNo] = roomName + "-" + rep.ChnnelId;
                        }
                      }
                    }

                    var config__ = settingVideoView(rep.EntpGbn == "1"?"E":"P","remote",newVideo,roomName + "-" + rep.ChnnelId,thumPos,rep.Nm,rep.PtoPath)

                    newVideo.remon = new Remon({ config: config__ , listener:  
                                {
                                    onInit(token) {
                                      console.log(`=================================remote remon.listener.onInit ${token} at listener closure ${channelId}`);
                                    },
                                    onConnect(chid) {
                                      console.log(`=================================remote remon.listener.onConnect ${chid} at listener`);
                                    },
                                    onComplete() {
                                      console.log(`=================================remote remon.listener.onComplete`);
                                    },
                                    onDisconnectChannel() {

                                    },
                                    onClose() {
                                      // is called when remon.close() method is called.
                                      console.log(`=================================remote remon.listener.onClose`);

                                      if($('div#'+channelId+"-remote").find('span#curres').length > 0)
                                      {
                                        $('div#'+channelId+"-remote").find('span#curres').text("").hide();
                                        $('div#'+channelId+"-remote").find('span#curbitrate').text("").hide();
                                      }
                                    },
                                    onError(error) {
                                      console.log(`=================================remote remon.listener.onError: ${error}`);
                                      // 4181, 4182 카메라 또는 마이크를 이용할 수 없음 - 처리 필요
                                    },
                                    onStat(result) {
                                      // const stat = `channelId:${channelId} State: r.video codex: ${result.remoteVideoCodec}  l.cand: ${result.localCandidate} /r.cand: ${result.remoteCandidate} /l.res: ${result.localFrameWidth} x ${result.localFrameHeight} /r.res: ${result.remoteFrameWidth} ${result.remoteFrameHeight} /l.rate: ${result.nowLocalFrameRate} /r.rate: ${result.nowRemoteFrameRate} / Health: ${result.rating}`
                                      //console.log("============remote stat: " + JSON.stringify(result))

                                      var width = result.remoteFrameWidth;
                                      var height = result.remoteFrameHeight;
                                      var rate = Math.round(result.nowRemoteFrameRate);

                                      var ident = roomName + "-" + channelId;
                                      if($('div#'+ident).find('span#curres').length > 0)
                                      {
                                        $('div#'+ident).find('span#curres').text(width+'x'+height).show();
                                        $('div#'+ident).find('span#curbitrate').text(rate+' FPS').show();
                                      }
                                      if($('div#'+channelId+"-remote").find('span#curres').length > 0)
                                      {
                                        $('div#'+channelId+"-remote").find('span#curres').text(width+'x'+height).show();
                                        $('div#'+channelId+"-remote").find('span#curbitrate').text(rate+' FPS').show();
                                      }

                                      /*
                                      if($('div#'+'localVideo').find('span#curres').length > 0)
                                      {
                                        $('div#'+'localVideo').find('span#curres').text(width+'x'+height).show();
                                        $('div#'+'localVideo').find('span#curbitrate').text(rate+' FPS').show();
                                      }
                                      */
                                    },
                      
                                  }
                               })

                    remote_remon[roomName + "-" + rep.ChnnelId] = newVideo.remon;  // 들고 있다가 삭제 필요.
                    // remote_remon.push(newVideo.remon);  // 들고 있다가 삭제 필요.
                    
                    newVideo.remon.joinCast(roomName + ":" + rep.ChnnelId)
                    // let newVideo = document.createElement('video') 
                    // videoAttrs.id = roomName + "-" + rep.ChnnelId;
                    // Object.keys(videoAttrs).forEach(key => newVideo.setAttribute(key, videoAttrs[key]))
                    // config.view.remote = `#${newVideo.id}`
                    // newVideo.remon = new Remon({ config })
                    // otherVideos.appendChild(newVideo)
                    // newVideo.remon.joinCast(roomName + ":" + rep.ChnnelId)
                }
            });		

              console.log(`================================= ajax_remom_get_key`);
              }  

            // function getConnectedDevices(type, callback) {
            //         navigator.mediaDevices.enumerateDevices()
            //         .then(devices => {
            //             const filtered = devices.filter(device => device.kind === type);
            //             callback(filtered);
            //         });
            // }

            // getConnectedDevices('videoinput', cameras => console.log('Cameras found', cameras));

            // please register your own service key from remotemonster site.
            let config = {
              credential: {
                key: key,
                serviceId: serviceId,
                wsurl : "wss://signal.remotemonster.com/ws",
                resturl : "https://signal.remotemonster.com/rest",
              },
              view: {
                remote: "#otherVideos",
                local: "#localVideo"
              },
              media: {
                  video: {
                      width: { min: 320, max: 640 }, //240 480
                      height: { min: 240, max: 480 }, //320 640
                      frameRate: { min: 8, max: 24 },
                      maxBandwidth: 400,
                      codec: 'vp8',
                      // facingMode: 'user' 모바일은 전면이다.
                  },
                  audio: true
              },
              dev: {
                  logLevel: 'ERROR'
              }
            };


            let config_r = {
              credential: {
                key: key,
                serviceId: serviceId,
                wsurl : "wss://signal.remotemonster.com/ws",
                resturl : "https://signal.remotemonster.com/rest",
              },
              view: {
                remote: "#otherVideos",
                local: "#localVideo"
              },
              media: {
                  video: {
                      width: { min: 100, max: 100 },
                      height: { min: 100, max: 100 },
                      frameRate: { min: 8, max: 25 },
                      maxBandwidth: 400,
                      codec: 'vp8',
                      // facingMode: 'user' 모바일은 전면이다.
                  },
                  audio: true
              },
              dev: {
                  logLevel: 'ERROR'
              }
            };

            const videoAttrs = {
                            class : "remote-video center w-320 h-240 rounded centered relative",
                            autoplay : true,
                            muted : true,
                            controls: true,
                            style :"background: rgba(0, 0, 0, 0.5); width: 640px;"
                          }

            const videoAttrs_local = {
                            // class : "local-video center w-205 h-155",
                            // autoplay : true,
                            // controls: true,
                            // style :"z-index:1;background: rgba(0, 0, 0, 0.5); width: 205;"
                          }


                          
                          
            const listener = {
              onInit(token) {
                console.log(`================================= remon.listener.onInit ${token} at listener`);
                 ajax_remom_save_key(token,pp_mem_no,entp_mem_sn);
                // console.log(`================================= end111111111 remon.listener.onInit ${token} at listener`);
                

              },
              onConnect(chid) {
                console.log(`================================= remon.listener.onConnect ${chid} at listener`);
              },
              onComplete() {
                console.log(`================================= remon.listener.onComplete: ${remon.getChannelId()} `);
                currentRoom[remon.getChannelId()] = true;

                // if (entp_gbn == "E") {
                //    videoElement = document.querySelector('video#localVideo');
                // }
                // else {
                //   videoElement = document.querySelector('video#box_localVideo');
                // }
                // // videoElement = document.querySelector('video');
                // audioSelect = document.querySelector('select#audioSource');
                // videoSelect = document.querySelector('select#videoSource');

                // audioSelect.onchange = getStream;
                // videoSelect.onchange = getStream;
                
                getDevices().then(gotDevices);
                // getStream().then(getDevices).then(gotDevices);

              },
              onDisconnectChannel() {
                // is called when other peer hang up.
                remon.close();
                isConnected = false;
              },
              onClose() {
                // is called when remon.close() method is called.
                console.log(`================================= remon.listener.onClose: ${remon.getChannelId()}`);
              },
              onError(error) {
                console.log(`================================= remon.listener.onError: ${remon.getChannelId()} ${error}`);
                if (error == 4181 || error == 4182) {
                  alert("error : 카메라 또는 마이크를 이용할 수 없음("+ error +")");
                }
                else if (error == 4341 ||
                    error == 4342 ||
                    error == 4343 || 
                    error == 4344 ||
                    error == 4345) {
                  alert("error : 네트워크 환경이 불안정 합니다. 다시 접속 부탁드립니다.("+ error +")");
                }
                else if (error == 2006) {
                  // 서버 오류.
                }
                else {
                  alert("error : " + error);
                  // if (isConnected) {
                  // remon.close();
                  // isConnected = false;
                  // }  
                  //startItv();
                }
                
                // 4181, 4182 카메라 또는 마이크를 이용할 수 없음 - 처리 필요
              },
              onStat(result) {
                //const stat = `l.video codex: ${result.localVideoCodec} State: l.cand: ${result.localCandidate} /r.cand: ${result.remoteCandidate} /l.res: ${result.localFrameWidth} x ${result.localFrameHeight} /r.res: ${result.remoteFrameWidth} ${result.nowRemoteFrameRate} /l.rate: ${result.nowLocalFrameRate} /r.rate: ${result.nowRemoteFrameRate} / Health: ${result.rating}`
                // console.log(JSON.stringify(result))

                var width = result.localFrameWidth;
                var height = result.localFrameHeight;
                var rate = Math.round(result.nowLocalFrameRate);

                //var ident = roomName + "-" + channelId;
                /*if($('div#'+'live-thum-stream-1').find('span#curres').length > 0)
                {
                  $('div#'+'live-thum-stream-1').find('span#curres').text(width+'x'+height).show();
                  $('div#'+'live-thum-stream-1').find('span#curbitrate').text(rate+' FPS').show();
                }*/

                if (entp_gbn == "E") {
                  if($('div#'+'localVideoStat').find('span#curres').length > 0)
                {
                  $('div#'+'localVideoStat').find('span#curres').text(width+'x'+height).show();
                  $('div#'+'localVideoStat').find('span#curbitrate').text(rate+' FPS').show();
                }
                }
                else {
                  if($('div#'+'localVideo').find('span#curres').length > 0)
                {
                  $('div#'+'localVideo').find('span#curres').text(width+'x'+height).show();
                  $('div#'+'localVideo').find('span#curbitrate').text(rate+' FPS').show();
                }
                }

                
              },
              onRoomEvent(result){
                //join
                console.log(`================================= onRoomEvent: ${result}`);
                  switch (result.event) {
                    case 'join':
                        if(!currentRoom[result.channel.id]){
                          currentRoom[result.channel.id] = true;
            
                            ajax_remom_get_key(result.channel.id.split(":")[1],0,'join');

                        }
                      break;
                    case 'leave':
                        if(currentRoom[result.channel.id] && result.channel.id !== remon.getChannelId()){
                          
                          let video = document.getElementById(result.channel.id.replace(":","-"));
                          if(session_key_list[result.channel.id.replace(":","-")] == "1") { // 기업
                            for(var i=0;i < otherVideo.length; i++) {
                              if (otherVideo[i] != null && otherVideo[i].contains(video) == true)
                                otherVideo[i].removeChild(video);
                            }

                            for(var i=0;i < liveThumStream.length; i++) {
                              if (liveThumStream[i] != null && liveThumStream[i].contains(video) == true) {
                                liveThumStream[i].removeChild(video);
                                var mute_video = liveThumStream[i].querySelector(".live-nvn-thum-mute");
                                mute_video.classList.add('hide');
                              }
                                
                            }

                              
                          }
                          else {
                            for(var i=0;i < otherVideo.length; i++) {
                              if (otherVideo[i] != null && otherVideo[i].contains(video) == true)
                                otherVideo[i].removeChild(video);
                            }

                            for(var i=0;i < liveThumStream.length; i++) {
                              if (liveThumStream[i] != null && liveThumStream[i].contains(video) == true)
                                liveThumStream[i].removeChild(video);
                            }
                          }
                          
                          // remote_remon[result.channel.id.replace(":","-")].close();
                          delete remote_remon[result.channel.id.replace(":","-")];
                          delete currentRoom[result.channel.id]
                        }
                      break;
                  }
                console.log(`EVENT FIRED: onRoomEvent channel Id : ${remon.getChannelId()}`)
                console.log(`EVENT FIRED: onRoomEvent: ${JSON.stringify(result)}`)
              },
              onMessage(msg) {
                console.log(`EVENT FIRED: onMessage:` + msg)
              }
            };

            // var listener_remote = {
            //   onInit(token) {
            //     console.log(`=================================remote remon.listener.onInit ${token} at listener`);
            //   },
            //   onConnect(chid) {
            //     console.log(`=================================remote remon.listener.onConnect ${chid} at listener`);
            //   },
            //   onComplete() {
            //     console.log(`=================================remote remon.listener.onComplete: ${remon.getChannelId()} `);
            //   },
            //   onDisconnectChannel() {

            //   },
            //   onClose() {
            //     // is called when remon.close() method is called.
            //     console.log(`=================================remote remon.listener.onClose: ${remon.getChannelId()}`);
            //   },
            //   onError(error) {
            //     console.log(`=================================remote remon.listener.onError: ${remon.getChannelId()} ${error}`);
            //     // 4181, 4182 카메라 또는 마이크를 이용할 수 없음 - 처리 필요
            //   },
            //   onStat(result) {
            //     const stat = `State: l.cand: ${result.localCandidate} /r.cand: ${result.remoteCandidate} /l.res: ${result.localFrameWidth} x ${result.localFrameHeight} /r.res: ${result.remoteFrameWidth} ${result.remoteFrameHeight} /l.rate: ${result.localFrameRate} /r.rate: ${result.remoteFrameRate} / Health: ${result.rating}`
            //     console.log(stat)
            //   },
 
            // };
            // async function getDevices() {
            //   var devices = await navigator.mediaDevices.enumerateDevices();
            //   for (let i = 0; i < devices.length; i++) {
            //     let device = devices[i];
            //     if (device.kind === "videoinput") {
            //       cameraList.push({ text: device.label, id: device.deviceId });
            //     } else if (device.kind === "audioinput") {
            //       micList.push({ text: device.label, id: device.deviceId });
            //     }
            //     // else if (device.kind === 'audiooutput') {
            //     //     speakerList.push({ text: device.label, id: device.deviceId })
            //     // }
            //   }
            //   for (let i = 0; i < cameraList.length; i++) {
            //     const videoInputOption = document.createElement("option");
            //     videoInputOption.value = cameraList[i].id;
            //     videoInputOption.text = cameraList[i].text;
            //     videoInputSelect.appendChild(videoInputOption);
            //   }
            //   for (let i = 0; i < micList.length; i++) {
            //     const audioInputOption = document.createElement("option");
            //     audioInputOption.value = micList[i].id;
            //     audioInputOption.text = micList[i].text;
            //     audioInputSelect.appendChild(audioInputOption);
            //   }
            // }
            function changeVideoInputDevice() {
              remon.setVideoDevice(
                videoInputSelect.options[videoInputSelect.selectedIndex].value
              );
            }
            function changeAudioInputDevice() {
              remon.setAudioDevice(
                audioInputSelect.options[audioInputSelect.selectedIndex].value
              );
            }
            function changeVideoCodec() {
              config.media.video.codec = videoCodecSelect.options[videoCodecSelect.selectedIndex].value;
              console.log(JSON.stringify(config));
              // Object.assign(config.media.video, {
              //   codec:
              //     videoCodecSelect.options[videoCodecSelect.selectedIndex].value
              // });
            }
            function changeVideoFPS() {
              Object.assign(config.media.video, {
                frameRate: {
                  max: parseInt(videoFPSInput.value, 10),
                  min: parseInt(videoFPSInput.value, 10)
                }
              });
            }
            function changeResolution() {
              resolution = resolutionSelect.options[
                resolutionSelect.selectedIndex
              ].text.split("-");
              config.media.video.width = resolution[0];
              config.media.video.height = resolution[1];
            }
            // getDevices();

            initHtml()
            

            function settingVideoView(entp_gbn,view_port,newVideo,videoId,thumPos,ppNm,ptoPath) {
              //let newVideo = document.createElement('video');
              if (entp_gbn == "E") {
                if (view_port == "local") {
                  videoAttrs_local.id = "localVideo";
                  $('div.'+thumPos).attr("id","localVideoStat");

                  videoAttrs_local.class = "local-video center w-200 h-150 rounded centered relative mirror";
                } 
                else {
                  videoAttrs_local.id = videoId;
                  $('div.'+thumPos).attr("id",videoId.split("-")[1]+"-remote");

                  videoAttrs_local.class = "remote-video center w-150 h-200 rounded centered relative mirror";

                  $('#live-thum-mute-'+thumPos).removeClass('hide');
                  
                }

               
                //videoAttrs_local.style = "z-index:1;background: rgba(0, 0, 0, 0.5); width: 205px; height: 155px"
                videoAttrs_local.style = "background: rgba(0, 0, 0, 1); width: 100%; max-height: 140px";
                Object.keys(videoAttrs_local).forEach(key => newVideo.setAttribute(key, videoAttrs_local[key]))
                
                liveThumStream[thumPos].appendChild(newVideo)

                if (view_port == "local") {
                  config.view.local =  `#${newVideo.id}`;
                  //newVideo.setAttribute("muted",true)
                  newVideo.setAttribute("muted",'');
                  newVideo.setAttribute("playsinline",'');
                  newVideo.muted = true;
                  newVideo.playsinline = true;
                  newVideo.autoplay = true;

                  config.media.video.width.min = 480; //320
                  config.media.video.width.max = 480; //320
                  config.media.video.height.min = 360; //240
                  config.media.video.height.max = 360; //240
                  config.media.video.frameRate.min = 8;
                  config.media.video.frameRate.min = 24;
                  config.media.video.maxBandwidth = 400;
                  return config;
                } 
                else {
                  config_r.view.remote =  `#${newVideo.id}`;
                  newVideo.setAttribute("playsinline",'');
                  newVideo.playsinline = true;
                  newVideo.autoplay = true;
                  //newVideo.controls = true;

                  // config_r.media.video.width = 150; //320
                  // config_r.media.video.height = 200; //240

                  config_r.media.video.width.min = 200; //320
                  config_r.media.video.width.max = 200; //320
                  config_r.media.video.height.min = 150; //240
                  config_r.media.video.height.max = 150; //240
                  return config_r;
                }
              }
              else {
                let box_div = document.createElement('div');
                box_div.className = "live-nvn-face-box";
//                box_div.innerHTML = "<div class=\"live-nvn-face-top\"><img src=\"{{.PtoPath}}\" onerror=\"this.src='/static/images/img-profile-empty-02.svg'\" class=\"live-nvn-face-profile-pic\"><div class=\"live-nvn-face-profile-name\" id=\"live-nvn-face-profile-name\">"+ppNm+"</div></div>"
                box_div.innerHTML = "<div class='live-nvn-face-top'>"+"<span class='label tit5' id='' style='z-index: 1; position: absolute; '> <img src='"+ ptoPath + "' onerror=this.src='/static/images/img-profile-empty-02.svg' class='c' style='z-index: 1;display: inline-block;;margin-right:5px;width: 40px;height: 40px;border-radius: 40px;'>"+ppNm+"</span></div>"

                var stat_txt_html = "";
                if (view_port == "local") {
                  videoAttrs_local.id = "box_localVideo";
                  box_div.id = "localVideo";
                  //newVideo.setAttribute("muted",true)
                  newVideo.setAttribute("muted",'');
                  newVideo.setAttribute("playsinline",'');
                  newVideo.muted = true;
                  newVideo.playsinline = true;
                  newVideo.autoplay = true;
                } 
                else {
                  videoAttrs_local.id = "box_" + videoId;
                  box_div.id = videoId
                  newVideo.setAttribute("playsinline",'');
                  newVideo.playsinline = true;
                  newVideo.autoplay = true;
                  //newVideo.controls = true;

                  // 스피커 icon 만들기.
                  stat_txt_html = "<div class='live-nvn-thum-mute' id='live-thum-mute-apply' onClick='toggleRemoteMuteAudio($(\"" + `#${box_div.id}` + "\"))'><img src='/static/images/ic-live-video-call-mute-off.svg' class='live-thum-mute-pic'></div>";
                }

                //videoAttrs_local.class = "local-video center w-480 h-640"
                //videoAttrs_local.style = "z-index:1;background: rgba(0, 0, 0, 0.5); width: 480px;"
                videoAttrs_local.class = "local-video center w-360 h-480 rounded centered relative mirror";
                //videoAttrs_local.style = "z-index:1;background: rgba(0, 0, 0, 0.5); width: 360px;"
                videoAttrs_local.style = "background: rgba(0, 0, 0, 0.5); width: 100%; height: 100%"

                Object.keys(videoAttrs_local).forEach(key => newVideo.setAttribute(key, videoAttrs_local[key]))
                
                box_div.appendChild(newVideo)

                
                
                
                
                if(display_stat_flag) 
                  stat_txt_html +="<span class='label label-primary' id='curres' style='position: absolute; bottom: 0px; left: 0px;'></span>" +
                    "<span class='label label-info' id='curbitrate' style='position: absolute; bottom: 0px; right: 0px;'></span>";
                else stat_txt_html +="<span class='label label-primary hide' id='curres' style='position: absolute; bottom: 0px; left: 0px;'></span>" +
                    "<span class='label label-info hide' id='curbitrate' style='position: absolute; bottom: 0px; right: 0px;'></span>";
                if($('div#otherVideos1').find('div.live-nvn-face-box').length == 0) {
                  if(otherVideo[0] != null) {
                    otherVideo[0].appendChild(box_div);
                    box_div.innerHTML = box_div.innerHTML + stat_txt_html;
                  }
                }
                else if($('div#otherVideos2').find('div.live-nvn-face-box').length == 0) {
                  if(otherVideo[1] != null) {
                    otherVideo[1].appendChild(box_div);
                    box_div.innerHTML = box_div.innerHTML + stat_txt_html;
                  }
                  

                }
                else if($('div#otherVideos3').find('div.live-nvn-face-box').length == 0) {
                  if(otherVideo[2] != null) {
                    otherVideo[2].appendChild(box_div);
                    box_div.innerHTML = box_div.innerHTML + stat_txt_html;
                  }
                }
                else if($('div#otherVideos4').find('div.live-nvn-face-box').length == 0) {
                  if(otherVideo[3] != null) {
                    otherVideo[3].appendChild(box_div);
                    box_div.innerHTML = box_div.innerHTML + stat_txt_html;
                  }
                }
                else if($('div#otherVideos5').find('div.live-nvn-face-box').length == 0) {
                  if(otherVideo[4] != null) {
                    otherVideo[4].appendChild(box_div);
                    box_div.innerHTML = box_div.innerHTML + stat_txt_html;
                  }
                }
                else if($('div#otherVideos6').find('div.live-nvn-face-box').length == 0) {
                  if(otherVideo[5] != null) {
                    otherVideo[5].appendChild(box_div);
                    box_div.innerHTML = box_div.innerHTML + stat_txt_html;
                  }
                }


                if (view_port == "local") {
                  config.view.local =  `#${newVideo.id}`;
                  config.media.video.width.min = 240;
                  config.media.video.width.max = 240;
                  config.media.video.height.min = 320;
                  config.media.video.height.max = 320;
                  config.media.video.frameRate.min = 8;
                  config.media.video.frameRate.min = 20;
                  config.media.video.maxBandwidth = 400;
                  return config;
                } 
                else {
                  config_r.view.remote =  `#${newVideo.id}`;
                  config_r.media.video.width.min = 240;
                  config_r.media.video.width.max = 240;
                  config_r.media.video.height.min = 320;
                  config_r.media.video.height.max = 320;
                  return config_r;
                }

              }

              
            }

            function initHtml() {		
              
              // 면접관(기업)
              var num = 1;
              var my_num;
              // var apply_num = 0;
              for (var i = 0; i < member_list.length; i++) {
                
                
                if ('E' == member_list[i].LmEntpGbn) {	// 면접관
                  //$(`#live-thum-stream-${num}`).append(`<video class=\"live-thum-stream\" id=\"remoteVideo${num}\" autoplay controls></video>`);
                  $(`#live-thum-${num}-div`).removeClass("hide");

                  entp_mem_pos[member_list[i].LmPpChrgSn] = num - 1;
                  $(`#live-thum-stream-${num}-tit1`).append(`${member_list[i].LmPpChrgBpNm}`);

                  $(`#live-thum-stream-${num}-tit2`).append(`${member_list[i].LmPpChrgNm}`);

                  // $(`#live-thum-mute-${num}`).attr("id",`remoteMute${num}`);
                }
                else {
                  if(member_list[i].LmLiveStatCd == '04' || member_list[i].LmLiveStatCd == '01')
                    member_apply_cnt++;
                }
                
                num++;		
                
                //console.log(`====== member: ${member_list[i].LmPpChrgGbnCd}, ${member_list[i].LmPpChrgNm}, ${member_list[i].LmPpChrgBpNm}, ${member_list[i].LmPpChrgSn}`);		
                //console.log(`====== (${member_list[i].LmPpChrgNm}): ${vd_html}`);		
              }
              
              if(member_apply_cnt <= 0)
              {
                alert("방을 생성 할수 없습니다.");
                gracefulclose();
                return 
              }
              let livefacediv=[];
              livefacediv[0] = document.querySelector('#live-face-1-div');
              livefacediv[1] = document.querySelector('#live-face-2-div');
              livefacediv[2] = document.querySelector('#live-face-3-div');
              livefacediv[3] = document.querySelector('#live-face-4-div');
              livefacediv[4] = document.querySelector('#live-face-5-div');
              livefacediv[5] = document.querySelector('#live-face-6-div');

              mainbar = document.querySelector('#main-bar');
              mainbardummy = document.querySelector('#main-bar-bummy');
              main = document.querySelector('#main');
              dummy = document.querySelector('#dummy');
              //member_apply_cnt = 1;
              if (member_apply_cnt == 1) {
                $(livefacediv[0]).attr('class','col-xs-12 col-md-8');
              } else if(member_apply_cnt == 2) {
                $(livefacediv[0]).attr('class','col-xs-12 col-md-6');
                $(livefacediv[1]).attr('class','col-xs-12 col-md-6');
              } else if(member_apply_cnt == 3) {

                $(livefacediv[0]).attr('class','col-xs-12 col-md-4');
                $(livefacediv[1]).attr('class','col-xs-12 col-md-4');
                $(livefacediv[2]).attr('class','col-xs-12 col-md-4');
              } else if(member_apply_cnt == 4) {
                $(livefacediv[0]).attr('class','col-xs-12 col-md-6');
                $(livefacediv[1]).attr('class','col-xs-12 col-md-6');
                $(livefacediv[2]).attr('class','col-xs-12 col-md-6');
                $(livefacediv[3]).attr('class','col-xs-12 col-md-6');
              } else if(member_apply_cnt == 5) {
                $(mainbar).attr('class','col-xs-6 col-md-12');
                $(mainbardummy).remove();
                $(main).attr('class','col-xs-6 col-md-9');
                $(dummy).remove();
                $(livefacediv[0]).attr('class','col-xs-12 col-md-4');
                $(livefacediv[1]).attr('class','col-xs-12 col-md-4');
                $(livefacediv[2]).attr('class','col-xs-12 col-md-4');
                $(livefacediv[3]).attr('class','col-xs-12 col-md-6');
                $(livefacediv[4]).attr('class','col-xs-12 col-md-6');
              } else if(member_apply_cnt == 6) {
                $(mainbar).attr('class','col-xs-6 col-md-12');
                $(mainbardummy).remove();
                $(main).attr('class','col-xs-6 col-md-9');
                $(dummy).remove();
                $(livefacediv[0]).attr('class','col-xs-12 col-md-4');
                $(livefacediv[1]).attr('class','col-xs-12 col-md-4');
                $(livefacediv[2]).attr('class','col-xs-12 col-md-4');
                $(livefacediv[3]).attr('class','col-xs-12 col-md-4');
                $(livefacediv[4]).attr('class','col-xs-12 col-md-4');
                $(livefacediv[5]).attr('class','col-xs-12 col-md-4');
              }            

              for(var i = 0;i<member_apply_cnt;i++)
              {
                $(`#live-face-${i+1}-div`).removeClass("hide");
              }

              // setInterval(() => {
              //   if(remote_remon != null) {
                  
                  
              //     Object.keys(remote_remon).forEach(key => { 
              //       var stats = remote_remon[key].getHealth(); 
              //       console.log("======================== remote stat:" + JSON.stringify( stats));
              //     })
              //   }
              // }, 1000);
            }

    
            
            createDummyRemonForSearchLoop();
            startItv();
            //start();

            // RTCPeerConnection.getStats(function(stats) {
            //   var report = stats.result()[0];
            //   report.names().forEach(function(name) {
            //     console.log(name, report.stat(name));
            //   });
            // })

            async function start_check() {
              remon.sendMessage("ajsfljsadflkjaslfjlasjkf ");
              // setInterval(async function () {
              //     if (!isConnected) {
              //         dummyRemon.config.credential.serviceId = serviceId;
              //         dummyRemon.config.credential.key = key;
              //         var searchResult = await dummyRemon.fetchCasts();
              //         // while (channelList.firstChild) {
              //         //     channelList.removeChild(channelList.firstChild);
              //         // }
              //         // searchResult.forEach((ch, i) => {
              //         //     if (ch.status === 'COMPLETE' && ch.id !== myChannelId && !isCaster) {
              //         //         var btn = document.createElement("input");
              //         //         btn.type = "button";
              //         //         btn.name = ch.id;
              //         //         btn.value = ch.name;
              //         //         btn.className = "btn btn-primary btn-user btn-block text-center";
              //         //         btn.addEventListener('click', (evt) => {
              //         //             channelNameInput.value = ch.id;
              //         //             start(true);
              //         //             evt.preventDefault();
              //         //         }, false);

              //         //         channelList.appendChild(btn);
              //         //     }
              //         // });
              //     }
              // }, 3000);
            }


            async function startItv() {
              if (isConnected) {
                disConnectRemoteMonster();
              } 
              // else {
                isConnected = true;
                // document.querySelector('#enterBtn').innerHTML = "leave";

                let ch_id = await remon.createRoom(roomName);
               
                // let ch_id = remon.getChannelId();                
               // console.log("============================= ch_id: ", remon.getChannelId());

                let participants = await remon.fetchRooms(roomName);


                participants.forEach(async function(participant){
                  if(!currentRoom[participant.id]){
                          currentRoom[participant.id] = true;
                          ajax_remom_get_key(participant.id.split(":")[1],0,'fetch');
                            // let newVideo = document.createElement('video');
                            // videoAttrs.id =  participant.id.replace(":","-");
                            // Object.keys(videoAttrs).forEach(key => newVideo.setAttribute(key, videoAttrs[key]))
                            // config.view.remote = `#${newVideo.id}`
                            // newVideo.remon = new Remon({ config })
                            // otherVideos.appendChild(newVideo)
                            // await newVideo.remon.joinCast(newVideo.id.replace("-",":"));
                        }
                });
              //}
            }



            function createDummyRemonForSearchLoop() {
              if (remon) remon.close();

              let newVideo = document.createElement('video')

              thumPos = 0;
              if(entp_mem_pos[entp_mem_sn] != null)
              {
                thumPos = entp_mem_pos[entp_mem_sn];
              }

              var config_ = settingVideoView(entp_gbn,"local",newVideo,"",thumPos,pp_mem_nm,pto_path)
              

              
              remon = new Remon({ config : config_, listener });
            }

            function disConnectRemoteMonster() {

              Object.keys(currentRoom).forEach(function(id){
                  if( id !== remon.getChannelId()){
                    let video = document.getElementById(id.replace(":","-"));
                    if(session_key_list[id.replace(":","-")] == "1") { 
                      for(var i=0;i < otherVideo.length; i++) {
                        if (otherVideo[i] != null && otherVideo[i].contains(video) == true)
                          otherVideo[i].removeChild(video);
                      }

                      for(var i=0;i < liveThumStream.length; i++) {
                        if (liveThumStream[i] != null && liveThumStream[i].contains(video) == true)
                          liveThumStream[i].removeChild(video);
                      }
                    }
                    else {
                      for(var i=0;i < otherVideo.length; i++) {
                        if (otherVideo[i] != null && otherVideo[i].contains(video) == true)
                          otherVideo[i].removeChild(video);
                      }

                      for(var i=0;i < liveThumStream.length; i++) {
                        if (liveThumStream[i] != null && liveThumStream[i].contains(video) == true)
                          liveThumStream[i].removeChild(video);
                      }
                    }
                  }
                  delete currentRoom[id];
                })

              if(remote_remon != null) {
                Object.keys(remote_remon).forEach(key => remote_remon[key].close())
                // remote_remon.forEach( (val,idx,arr) => {
                //   remote_remon[idx].close();
                // });
                
              }
              

              if (remon) remon.close();
              isConnected = false;
            }

            function ajaxExitProc(exit_stat) {			

              var in_url = (exit_stat == "Exit" ? '/live/nvn/exit' : '/live/nvn/close');

              $.ajax({
                cache: false,
                url: in_url,
                data: {
                    entp_mem_no: entp_mem_no,	
                    entp_mem_sn: entp_mem_sn,	
                    recrut_sn: recrut_sn,
                    pp_mem_no: pp_mem_no,
                    pp_mem_nm: pp_mem_nm,
                    live_sn: live_sn
                  },
                type: 'POST',
                dataType: "json",
                error: function (e) {
                  console.log("error" + e);
                },
                success: function (rep) {
                    if (rep.LirEntpMemNo) {
                  		var entp_mem_no = rep.LirEntpMemNo;	// 기업 회원 번호
                  		var recrut_sn = rep.LirRecrutSn;
                  		var pp_mem_no = rep.LirPpMemNo;
                  		var pp_mem_nm = rep.LirPpMemNm;
                  		var live_sn = rep.LirLiveSn;
                  		var entp_nm = rep.LirEntpNm;
                  		var name = rep.LirNm;
                  		var live_itv_sday = rep.LirLiveItvSday;
                  		var live_itv_stime = rep.LirLiveItvSTime;
                  		var live_itv_eday = rep.LirLiveItvEday;
                  		var live_itv_etime = rep.LirLiveItvETime;
                  		var live_itv_jt = rep.LirLiveItvJt;
                  		var sdt_tstmp = rep.LirSdtTstmp;

                  		closePopup();			

	                  	var returnValue = {
		                    stat : exit_stat,
		                    recrut_sn: recrut_sn,
		                    pp_mem_no: pp_mem_no,
		                    pp_mem_nm: pp_mem_nm,
		                    entp_nm: entp_nm,
		                    live_sn: live_sn,
		                    live_itv_sday: live_itv_sday,
		                    live_itv_stime: live_itv_stime,
		                    live_itv_eday: live_itv_eday,
		                    live_itv_etime: live_itv_etime,
		                    live_itv_jt: live_itv_jt,
		                    sdt_tstmp: sdt_tstmp
	                    };
                    
                  		if (window.opener) {
                     		if (window.opener.getLiveItvResult) {
                  				window.opener.getLiveItvResult(JSON.stringify(returnValue));
                     		} else {   
                        		sessionStorage.removeItem(`LiveItv_${live_sn}`); 
                         }
                         
                         window.open(location, '_self').close();	
                  		} else {
                         sessionStorage.removeItem(`LiveItv_${live_sn}`); 
                         window.close();	  // <-- 크롬,사파리,파이어는 에러.
                  		}
                            
                  							
                    } else {                    
                        var returnValue = {
                            stat : "Force_Exit",
                            recrut_sn: recrut_sn,
                            pp_mem_no: pp_mem_no,
                            live_sn: live_sn
                        };
                                
                        if (window.opener) {
                            if (window.opener.getLiveItvResult)
                                window.opener.getLiveItvResult(JSON.stringify(returnValue)); 		
                            else {    
                                sessionStorage.removeItem(`LiveItv_${live_sn}`);
                            }
                        } else {
                            sessionStorage.removeItem(`LiveItv_${live_sn}`); 
                        }

	                  window.open(location, '_self').close();						
                        window.opener.location.href = "/login";
                    }
                }
              });
            }

            // enterBtn.addEventListener("click",
            //   evt => {
            //     startItv();
            //     evt.preventDefault();
            //   },
            //   false
            // );

            // checkBtn.addEventListener("click",
            //   evt => {
            //     start_check();
            //     evt.preventDefault();
            //   },
            //   false
            // );

            	$(document).ready(function() {

                openPopup("live_audio_video");		

                //initHtml(); 
              });		
            
            $(document).off("click", "#btn_live_audio_video_ok").on("click", "#btn_live_audio_video_ok", function (e) {
              closePopup("live_audio_video");	
              
              $(".live-wrapper").show();
              
              //startItv();
            });	

                      
            $(document).off("click", "#btn_live_audio_video_cancel").on("click", "#btn_live_audio_video_cancel", function (e) {
              closePopup("live_audio_video");	
              
              var returnValue = {
                stat : "Force_Exit",
                recrut_sn: recrut_sn,
                pp_mem_no: pp_mem_no,
                live_sn: live_sn
              };
                      
              if (window.opener) {
              	  if (window.opener.getLiveItvResult) {
                	  window.opener.getLiveItvResult(JSON.stringify(returnValue)); 
                  } else {    
                      sessionStorage.removeItem(`LiveItv_${live_sn}`);
                  }
              } else {    
                  sessionStorage.removeItem(`LiveItv_${live_sn}`);              
              }

              window.close();
            });

            $(document).off("click", "#btn_live_exit").on("click", "#btn_live_exit", function (e) {
              e.preventDefault();
              disConnectRemoteMonster();
              ajaxExitProc("Exit");		
            });

            $(document).off("click", "#btn_live_close").on("click", "#btn_live_close", function (e) {
              e.preventDefault();
              disConnectRemoteMonster();
              ajaxExitProc("Close");
            });	

          </script>
        </div>
        <!-- End of Main Content -->

        <!-- Footer -->
        <footer class="sticky-footer bg-white">
        </footer>
        <!-- End of Footer -->
      </div>
      <!-- End of Content Wrapper -->
    </div>
    <!-- End of Page Wrapper -->


    <!-- Bootstrap core JavaScript-->
    <!-- <script src="vendor/jquery/jquery.min.js"></script> -->
    <!-- <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script> -->

    <!-- Core plugin JavaScript-->
    <!-- <script src="vendor/jquery-easing/jquery.easing.min.js"></script> -->

    <!-- Custom scripts for all pages-->
    <!-- <script src="js/sb-admin-2.min.js"></script> -->

    <script>
      // $(document).ready(function() {
      //   //$("#accordionSidebar").load("nav.html");
      // });
    </script>
  </body>
</html>